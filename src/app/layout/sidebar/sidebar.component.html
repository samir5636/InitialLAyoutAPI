<div class="sidebar-container">
  <div class="sidebar-nav">
    <div class="nav-item" [class.active]="activeNavItem === 'collections'" (click)="setActiveNavItem('collections')">
      <mat-icon>folder</mat-icon>
      <span>Collections</span>
    </div>
    <div class="nav-item" [class.active]="activeNavItem === 'environments'" (click)="setActiveNavItem('environments')">
      <mat-icon>layers</mat-icon>
      <span>Env</span>
    </div>
    <div class="nav-item" [class.active]="activeNavItem === 'history'" (click)="setActiveNavItem('history')">
      <mat-icon>history</mat-icon>
      <span>History</span>
    </div>
  </div>

  <div class="sidebar-content">
    <div *ngIf="activeNavItem === 'collections'" class="content-area collections-area">
      <div class="content-header">
          <div class="action-buttons">
            <button mat-icon-button><mat-icon>add</mat-icon></button>
          </div>
        <div class="search-area">
          <mat-icon class="filter-icon">filter_list</mat-icon>
          <input type="text" placeholder="Filter" class="search-input">
        </div>
      </div>

      <div class="collections-list">
        <div *ngFor="let collection of collections" class="collection-item">
          <div class="collection-header" (click)="toggleExpand(collection.id)">
            <mat-icon>{{ isExpanded(collection.id) ? 'collections_bookmark' : 'collections' }}</mat-icon>
            <span>{{ collection.name }}</span>
          </div>
          
          <div *ngIf="isExpanded(collection.id)" class="collection-content">
            <!-- Collection's requests -->
            <div cdkDropList
                 [id]="'collection-' + collection.id"
                 [cdkDropListConnectedTo]="getConnectedLists()"
                 (cdkDropListDropped)="onDrop($event)"
                 class="request-list"
                 [cdkDropListData]="collection.requests">
              <div *ngFor="let request of collection.requests" 
                   class="request-item"
                   cdkDrag
                   [cdkDragData]="request"
                   (cdkDragStarted)="onDragStarted(request)"
                   (cdkDragEnded)="onDragEnded()">
                <div class="request-header">
                  <mat-icon>subdirectory_arrow_right</mat-icon>
                  <span class="request-method" [ngClass]="request.method.toLowerCase()">{{ request.method }}</span>
                  <span>{{ request.name }}</span>
                </div>
              </div>
            </div>

            <!-- Collection's folders -->
            <div cdkDropList
                 [id]="'collection-folders-' + collection.id"
                 [cdkDropListConnectedTo]="getConnectedLists()"
                 (cdkDropListDropped)="onDrop($event)"
                 class="folder-list"
                 [cdkDropListData]="collection.folders">
              <div *ngFor="let folder of collection.folders" 
                   class="folder-item"
                   cdkDrag
                   [cdkDragData]="folder"
                   (cdkDragStarted)="onDragStarted(folder)"
                   (cdkDragEnded)="onDragEnded()">
                <div class="folder-header" (click)="toggleExpand(folder.id)">
                  <mat-icon>{{ isExpanded(folder.id) ? 'folder_open' : 'folder' }}</mat-icon>
                  <span>{{ folder.name }}</span>
                </div>

                <div *ngIf="isExpanded(folder.id)" class="folder-content">
                  <!-- Folder's requests -->
                  <div cdkDropList
                       [id]="'folder-' + folder.id"
                       [cdkDropListConnectedTo]="getFolderConnectedLists(folder)"
                       (cdkDropListDropped)="onDrop($event)"
                       class="request-list"
                       [cdkDropListData]="folder.requests">
                    <div *ngFor="let request of folder.requests" 
                         class="request-item"
                         cdkDrag
                         [cdkDragData]="request"
                         (cdkDragStarted)="onDragStarted(request)"
                         (cdkDragEnded)="onDragEnded()">
                      <div class="request-header">
                        <mat-icon>subdirectory_arrow_right</mat-icon>
                        <span class="request-method" [ngClass]="request.method.toLowerCase()">{{ request.method }}</span>
                        <span>{{ request.name }}</span>
                      </div>
                    </div>
                  </div>

                  <!-- Nested folders -->
                  <div cdkDropList
                       [id]="'folder-folders-' + folder.id"
                       [cdkDropListConnectedTo]="getFolderConnectedLists(folder)"
                       (cdkDropListDropped)="onDrop($event)"
                       class="folder-list"
                       [cdkDropListData]="folder.folders">
                    <div *ngFor="let nestedFolder of folder.folders" 
                         class="folder-item"
                         cdkDrag
                         [cdkDragData]="nestedFolder"
                         (cdkDragStarted)="onDragStarted(nestedFolder)"
                         (cdkDragEnded)="onDragEnded()">
                      <div class="folder-header" (click)="toggleExpand(nestedFolder.id)">
                        <mat-icon>{{ isExpanded(nestedFolder.id) ? 'folder_open' : 'folder' }}</mat-icon>
                        <span>{{ nestedFolder.name }}</span>
                      </div>

                      <div *ngIf="isExpanded(nestedFolder.id)" class="folder-content">
                        <div cdkDropList
                             [id]="'folder-' + nestedFolder.id"
                             [cdkDropListConnectedTo]="getFolderConnectedLists(nestedFolder)"
                             (cdkDropListDropped)="onDrop($event)"
                             class="request-list"
                             [cdkDropListData]="nestedFolder.requests">
                          <div *ngFor="let request of nestedFolder.requests" 
                               class="request-item"
                               cdkDrag
                               [cdkDragData]="request"
                               (cdkDragStarted)="onDragStarted(request)"
                               (cdkDragEnded)="onDragEnded()">
                            <div class="request-header">
                              <mat-icon>subdirectory_arrow_right</mat-icon>
                              <span class="request-method" [ngClass]="request.method.toLowerCase()">{{ request.method }}</span>
                              <span>{{ request.name }}</span>
                            </div>
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div *ngIf="activeNavItem === 'environments'" class="content-area environments-area">
      <div class="content-header">
        <span class="area-title">Environments</span>
        <button mat-icon-button><mat-icon>add</mat-icon></button>
      </div>
      <div class="environments-list">
        <div class="environment-item">
          <span>Development</span>
        </div>
        <div class="environment-item">
          <span>Staging</span>
        </div>
        <div class="environment-item">
          <span>Production</span>
        </div>
      </div>
    </div>

    <div *ngIf="activeNavItem === 'flows'" class="content-area flows-area">
      <div class="content-header">
        <span class="area-title">Flows</span>
        <button mat-icon-button><mat-icon>add</mat-icon></button>
      </div>
      <div class="no-flows">
        <p>No flows available</p>
        <button mat-button color="primary">Create Flow</button>
      </div>
    </div>

    <div *ngIf="activeNavItem === 'history'" class="content-area history-area">
      <div class="content-header">
        <span class="area-title">History</span>
        <div class="action-buttons">
          <button mat-icon-button><mat-icon>filter_list</mat-icon></button>
          <button mat-icon-button><mat-icon>more_vert</mat-icon></button>
        </div>
      </div>
      <div class="history-list">
        <div class="history-item">
          <div class="request-info">
            <span class="request-method get">GET</span>
            <span class="request-url">/api/books</span>
          </div>
          <span class="request-time">10:30 AM</span>
        </div>
        <div class="history-item">
          <div class="request-info">
            <span class="request-method post">POST</span>
            <span class="request-url">/api/books</span>
          </div>
          <span class="request-time">Yesterday</span>
        </div>
        <div class="history-item">
          <div class="request-info">
            <span class="request-method put">PUT</span>
            <span class="request-url">/api/books/1</span>
          </div>
          <span class="request-time">May 5</span>
        </div>
      </div>
    </div>
  </div>
</div>
